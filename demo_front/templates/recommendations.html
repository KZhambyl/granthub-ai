{% extends "base.html" %}

{% block content %}
<div class="container" style="margin-top: 40px; max-width: 600px;">
  <h2>Your Recommendations</h2>
  <ul id="recommendations-list"></ul>
</div>

<script>
async function loadRecommendations() {
  const token = localStorage.getItem("access_token");
  if (!token) {
    window.location.href = "/login"; 
    return;
  }

  try {
    const response = await fetch("/recommendations/data", {
      headers: {
        "Authorization": "Bearer " + token
      }
    });

    if (response.ok) {
      const data = await response.json();
      const list = document.getElementById("recommendations-list");
      list.innerHTML = "";

      data.recommendations.forEach(rec => {
          const li = document.createElement("li");
          li.innerHTML = `
              <div class="item-card">
                  ${rec.data.image_url ? `<img class="card-image" src="${rec.data.image_url}" alt="${rec.data.title}">` : ""}
                  <div class="card-content">
                      <h3>${rec.data.title}</h3>
                      <p><b>Provider:</b> ${rec.data.provider || "-"}</p>
                      <p><b>Description:</b> ${rec.data.description || ""}</p>
                      ${rec.data.source_url ? `<p><a href="${rec.data.source_url}" target="_blank">Link</a></p>` : ""}
                  </div>
              </div>
          `;
          list.appendChild(li);
      });

    } else {
      document.getElementById("recommendations-list").innerHTML =
        "❌ Failed to load: " + (await response.text());
    }

  } catch (err) {
    document.getElementById("recommendations-list").innerHTML =
      "⚠️ Error: " + err.message;
  }
}

loadRecommendations();
</script>
{% endblock %}
